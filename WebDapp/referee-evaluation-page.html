<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HRKey â€“ Provide Your Reference</title>

  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family:'Rubik',system-ui,sans-serif; background:#0a0a0a; color:#e5e7eb; }
    .page { max-width: 840px; margin: 40px auto; padding: 0 16px; }
    .card { background: linear-gradient(135deg, #13161f 0%, #1b1f2a 100%); border-radius: 16px; padding: 28px; box-shadow: 0 10px 30px rgba(0,0,0,.35); border:1px solid rgba(0,196,199,.18); }
    h1 { font-size: 26px; margin: 0 0 8px; color:#fff; }
    p.muted { color:#9ca3af; margin: 2px 0 18px; }
    label { display:block; font-weight:600; color:#00C4C7; margin: 12px 0 6px; }
    input, textarea, select {
      width:100%; padding:12px; border-radius:10px; border:1px solid rgba(0,196,199,.25);
      background:#0f172a; color:#fff; font-size:14px;
    }
    textarea { resize: vertical; min-height: 110px; }
    .stars { display:flex; gap:8px; margin:8px 0 4px; }
    .star { cursor:pointer; font-size:28px; color:#374151; transition:transform .1s ease; }
    .star.active { color:#f59e0b; }
    .star:hover { transform: scale(1.05); }
    .actions { margin-top: 18px; display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .btn {
      padding: 12px 20px; border-radius: 12px; font-weight:600; cursor:pointer; border:none;
      box-shadow: 0 6px 20px rgba(0,196,199,.25);
    }
    .btn-primary { background: linear-gradient(135deg, #00C4C7 0%, #00d2cc 100%); color:#000; }
    .btn-secondary { background: transparent; border:2px solid #00C4C7; color:#00C4C7; }
    .alert { margin-top:14px; padding:12px 14px; border-radius:10px; }
    .alert-success { background:rgba(16,185,129,.1); color:#10b981; border-left:4px solid #10b981; }
    .alert-error { background:rgba(239,68,68,.12); color:#ef4444; border-left:4px solid #ef4444; }
    .tiny { color:#94a3b8; font-size:12px; margin-top:2px; }

    /* Thanks view */
    .center { text-align:center; }
    .big { font-size: 20px; color:#fff; margin: 6px 0 10px; }
    .sub { color:#9ca3af; margin: 0 0 18px; }
    .cta { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
    .badge { display:inline-block; background:#00C4C7; color:#000; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:700; }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- EVALUATION VIEW -->
      <div id="evalView">
        <h1>Provide your reference</h1>
        <p class="muted" id="refLine">Please rate and add a brief comment for this request.</p>

        <form id="evalForm" novalidate>
          <label>Overall rating *</label>
          <div class="stars" id="stars">
            <span class="star" data-v="1">â˜…</span>
            <span class="star" data-v="2">â˜…</span>
            <span class="star" data-v="3">â˜…</span>
            <span class="star" data-v="4">â˜…</span>
            <span class="star" data-v="5">â˜…</span>
          </div>
          <div class="tiny" id="ratingHint">Click a star (1â€“5)</div>
          <input type="hidden" id="rating" value="0">

          <label for="comment">Your feedback *</label>
          <textarea id="comment" placeholder="What stood out about their performance? What would you highlight?"></textarea>

          <label for="relationship">Your relationship</label>
          <select id="relationship">
            <option value="">Select</option>
            <option value="Direct Manager">Direct Manager</option>
            <option value="Supervisor">Supervisor</option>
            <option value="Colleague">Colleague</option>
            <option value="HR Manager">HR Manager</option>
            <option value="Client">Client</option>
          </select>

          <label for="yourName">Your name (optional)</label>
          <input id="yourName" type="text" placeholder="e.g. Ana Manager">

          <div class="actions">
            <button type="submit" class="btn btn-primary" id="submitBtn">âœ… Confirm & Send</button>
            <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
            <span class="tiny" id="statusText"></span>
          </div>
        </form>

        <div id="alertBox"></div>
      </div>

      <!-- THANKS VIEW -->
      <div id="thanksView" class="center" style="display:none">
        <div style="font-size:48px; margin-top:4px;">ðŸŽ‰</div>
        <div class="big">Thanks for providing your reference!</div>
        <p class="sub">
          Youâ€™ve helped verify someoneâ€™s professional profile.  
          Want to build your own? Unlock HRKey <span class="badge">JUNGLE PASS</span>.
        </p>
        <div class="cta">
          <a class="btn btn-primary" href="/auth.html?coupon=JUNGLE">ðŸš€ Create Free Account</a>
          <a class="btn btn-secondary" href="/index.html">Maybe later</a>
        </div>
        <div class="tiny" style="margin-top:10px;">Youâ€™ll be redirected shortlyâ€¦</div>
      </div>
    </div>
  </div>

  <script>
    // ===== Config destino con pase =====
    const LANDING_WITH_COUPON = "/auth.html?coupon=JUNGLE";

    // ===== Utilidad UI =====
    function showAlert(msg, type='success') {
      const box = document.getElementById('alertBox');
      box.innerHTML = `<div class="alert ${type==='success'?'alert-success':'alert-error'}">${msg}</div>`;
    }
    function setStatus(msg) {
      document.getElementById('statusText').textContent = msg || '';
    }

    // ===== Carga del ref de la URL (si existe) =====
    const url = new URL(location.href);
    const refId = url.searchParams.get('ref') || '';
    if (refId) {
      document.getElementById('refLine').textContent =
        "Reference request ID: " + refId + ". Please complete the evaluation below.";
    }

    // ===== Estrellas =====
    (function setupStars(){
      const stars = Array.from(document.querySelectorAll('.star'));
      const ratingInput = document.getElementById('rating');
      const hint = document.getElementById('ratingHint');

      function paint(v) {
        stars.forEach(s => s.classList.toggle('active', Number(s.dataset.v) <= v));
        hint.textContent = v ? `Selected: ${v} / 5` : 'Click a star (1â€“5)';
      }
      stars.forEach(st => {
        st.addEventListener('click', () => {
          const v = Number(st.dataset.v);
          ratingInput.value = v;
          paint(v);
        });
      });
    })();

    // ===== Submit evaluaciÃ³n =====
    async function submitEvaluation(e) {
      e.preventDefault();
      const rating = Number(document.getElementById('rating').value || '0');
      const comment = (document.getElementById('comment').value || '').trim();

      if (!rating || rating < 1) {
        showAlert('Please select a rating (at least 1 star).', 'error');
        return;
      }
      if (!comment) {
        showAlert('Please add a brief comment.', 'error');
        return;
      }

      const relation = document.getElementById('relationship').value || '';
      const yourName = document.getElementById('yourName').value || '';

      try {
        setStatus('Sending...');
        await new Promise(r => setTimeout(r, 400)); // simula latencia

        // Marca para el banner de â€œreferee â†’ signupâ€
        const info = {
          hasProvidedReference: true,
          when: new Date().toISOString(),
          refId,
          rating, comment, relation, yourName
        };
        localStorage.setItem('hrkey_referee_info', JSON.stringify(info));

        // Cambia a la vista de "Thanks"
        document.getElementById('evalView').style.display = 'none';
        document.getElementById('thanksView').style.display = 'block';

        // Auto-redirect opcional
        setTimeout(() => location.assign(LANDING_WITH_COUPON), 7000);
      } catch (err) {
        console.error('referee submit error:', err);
        showAlert('âŒ Something went wrong. Please try again.', 'error');
        setStatus('');
      }
    }

    // ===== Init =====
    document.getElementById('evalForm').addEventListener('submit', submitEvaluation);
    document.getElementById('cancelBtn').addEventListener('click', () => {
      location.assign(LANDING_WITH_COUPON);
    });
  </script>
</body>
</html>
