# üéØ HRKey - Gu√≠a de Entendimiento R√°pido

## ¬øQu√© es HRKey en 30 segundos?

**HRKey** es una plataforma de **referencias profesionales verificadas** que combina:
- üìß Web tradicional (emails, base de datos)
- ‚õìÔ∏è Blockchain (inmutabilidad, verificaci√≥n)

**Prop√≥sito**: Que empresas/reclutadores puedan verificar referencias laborales de forma confiable.

---

## üèóÔ∏è Componentes Principales

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. FRONTEND (Next.js en Vercel)                    ‚îÇ
‚îÇ     ‚Üì                                               ‚îÇ
‚îÇ     ‚Ä¢ Homepage con marketing                        ‚îÇ
‚îÇ     ‚Ä¢ Dashboard para gestionar referencias          ‚îÇ
‚îÇ     ‚Ä¢ P√°gina de verificaci√≥n para referentes        ‚îÇ
‚îÇ     ‚Ä¢ Conecta con wallet (MetaMask)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ                 ‚îÇ                 ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ  2. SUPABASE     ‚îÇ  ‚îÇ3. BACKEND‚îÇ   ‚îÇ4. BLOCKCHAIN ‚îÇ
         ‚îÇ  (PostgreSQL)    ‚îÇ  ‚îÇ (Express)‚îÇ   ‚îÇ Base Sepolia ‚îÇ
         ‚îÇ                  ‚îÇ  ‚îÇ opcional ‚îÇ   ‚îÇ              ‚îÇ
         ‚îÇ  ‚Ä¢ Users         ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ ‚Ä¢ Contrato   ‚îÇ
         ‚îÇ  ‚Ä¢ References    ‚îÇ                 ‚îÇ   HRKeyReg.  ‚îÇ
         ‚îÇ  ‚Ä¢ Invites       ‚îÇ                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ  ‚Ä¢ Wallets       ‚îÇ
         ‚îÇ  ‚Ä¢ Plans         ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ Flujo de Uso T√≠pico

### Paso 1: Solicitar Referencia
```
Usuario ‚Üí Dashboard ‚Üí "Nueva referencia"
                   ‚Üí Llena datos del referente
                   ‚Üí Guarda en Supabase (status: draft)
```

### Paso 2: Enviar Invitaci√≥n
```
Usuario ‚Üí "Enviar a verificaci√≥n"
       ‚Üí Backend genera token √∫nico
       ‚Üí Crea link: /ref/verify?token=abc123
       ‚Üí (Opcional) Env√≠a email autom√°tico
       ‚Üí Status cambia a: submitted
```

### Paso 3: Referente Completa
```
Referente ‚Üí Recibe email con link
         ‚Üí Abre /ref/verify?token=abc123
         ‚Üí Llena formulario (rating, comentarios)
         ‚Üí Submit ‚Üí Guarda en Supabase
         ‚Üí Status cambia a: active
```

### Paso 4: (Opcional) Guardar en Blockchain
```
Usuario ‚Üí "Guardar en blockchain"
       ‚Üí MetaMask pide confirmaci√≥n
       ‚Üí Paga ~$0.01 de gas
       ‚Üí Referencia queda inmutable onchain
       ‚Üí Status cambia a: verified
```

---

## üìä Modelo de Datos Simplificado

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     users       ‚îÇ (Supabase Auth)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ           ‚îÇ
         ‚ñº           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ user_plans   ‚îÇ  ‚îÇ references   ‚îÇ
‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ ‚Ä¢ plan       ‚îÇ  ‚îÇ ‚Ä¢ owner_id   ‚îÇ‚îÄ‚îÄ‚îê
‚îÇ ‚Ä¢ features   ‚îÇ  ‚îÇ ‚Ä¢ referee    ‚îÇ  ‚îÇ
‚îÇ ‚Ä¢ limit      ‚îÇ  ‚îÇ ‚Ä¢ rating     ‚îÇ  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚Ä¢ status     ‚îÇ  ‚îÇ
                  ‚îÇ ‚Ä¢ tx_hash    ‚îÇ  ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
                         ‚îÇ          ‚îÇ
                         ‚ñº          ‚îÇ
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
                  ‚îÇreference_    ‚îÇ‚óÑ‚îÄ‚îò
                  ‚îÇinvites       ‚îÇ
                  ‚îÇ              ‚îÇ
                  ‚îÇ ‚Ä¢ token      ‚îÇ
                  ‚îÇ ‚Ä¢ expires_at ‚îÇ
                  ‚îÇ ‚Ä¢ status     ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Estados de Referencia**:
- `draft` ‚Üí En borrador
- `submitted` ‚Üí Invitaci√≥n enviada
- `active` ‚Üí Completada por referente
- `verified` ‚Üí Guardada en blockchain

---

## üí∞ Modelo de Negocio

### Plan FREE
- ‚úÖ 1 referencia
- ‚úÖ Ver referencias
- ‚ùå No blockchain
- ‚ùå No peer validations

### Plan PRO ($9.99 lifetime)
- ‚úÖ Referencias ilimitadas
- ‚úÖ Guardar en blockchain
- ‚úÖ Peer validations
- ‚úÖ Compartir referencias
- ‚úÖ Datos verificables

**Pago**: Stripe (tarjeta de cr√©dito)

---

## üîê Seguridad y Privacidad

### Autenticaci√≥n
- **Supabase Auth**: Email/password, OAuth (Google, etc)
- **JWT tokens**: Sesiones seguras
- **RLS**: Row Level Security en PostgreSQL

### Wallets
- **Custodial**: App guarda las keys (encriptadas con AES-256)
- **External**: Usuario conecta su MetaMask
- **Ventaja custodial**: Onboarding m√°s f√°cil
- **Ventaja external**: Usuario controla 100%

### Privacidad en Blockchain
- ‚ùå **NO** se guarda informaci√≥n personal onchain
- ‚úÖ Solo hash del email + rating + IPFS hash
- ‚úÖ Metadata completa en Supabase (privado)

---

## üåê Servicios Externos

| Servicio | Prop√≥sito | Costo |
|----------|-----------|-------|
| **Vercel** | Hosting frontend | Gratis hasta 100GB bandwidth |
| **Supabase** | Database + Auth | Gratis hasta 500MB DB |
| **Resend** | Emails | Gratis hasta 3,000/mes |
| **Stripe** | Pagos | 2.9% + $0.30 por transacci√≥n |
| **Coinbase CDP** | Blockchain APIs | Gratis con l√≠mites |
| **Base Sepolia** | Testnet | Gratis (ETH falso) |

**Total para empezar**: $0 (todo en free tiers)

---

## üöÄ Deployment: 3 Opciones

### Opci√≥n 1: Solo Frontend (M√≠nimo Viable)
```bash
cd HRkey
vercel --prod
```
**Qu√© funciona**:
- ‚úÖ Homepage
- ‚úÖ Dashboard
- ‚úÖ Referencias (si configuras Supabase)
- ‚ùå Emails autom√°ticos
- ‚ùå Blockchain

**Variables necesarias**:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### Opci√≥n 2: Frontend + Emails
**Variables adicionales**:
- `SUPABASE_SERVICE_ROLE_KEY`
- `RESEND_API_KEY`

**Qu√© funciona**:
- ‚úÖ Todo lo anterior
- ‚úÖ Emails autom√°ticos

### Opci√≥n 3: Full Stack (Todo)
**Variables adicionales**:
- `NEXT_PUBLIC_CDP_API_KEY`
- `NEXT_PUBLIC_CONTRACT_ADDRESS`
- `STRIPE_SECRET_KEY`
- `STRIPE_WEBHOOK_SECRET`

**Qu√© funciona**:
- ‚úÖ Todo
- ‚úÖ Blockchain
- ‚úÖ Pagos
- ‚úÖ Features completas

---

## üìñ Documentaci√≥n Disponible

1. **`ARCHITECTURE.md`** (este archivo)
   - Arquitectura completa
   - Diagramas
   - Explicaci√≥n t√©cnica profunda

2. **`DEPLOYMENT.md`**
   - Gu√≠a paso a paso para deployar
   - Configuraci√≥n de servicios
   - Troubleshooting

3. **`QUICKSTART.md`**
   - Deploy en 5 minutos
   - M√≠nimo necesario

4. **`README.md`** (del proyecto)
   - Descripci√≥n del producto
   - Features
   - Screenshots

---

## ‚ùì Preguntas Frecuentes

### ¬øNecesito saber blockchain para usar esto?
**No**. Como usuario final, es transparente. Como developer, las librer√≠as (ethers.js, wagmi) abstraen la complejidad.

### ¬øEs caro guardar en blockchain?
**No**. Base es un L2, transacciones cuestan ~$0.001 - $0.01. Mucho m√°s barato que Ethereum mainnet.

### ¬øQu√© pasa si un usuario no paga?
Queda en plan FREE, con l√≠mite de 1 referencia. Las referencias existentes siguen disponibles.

### ¬øLos emails se env√≠an autom√°ticamente?
Solo si configuras `RESEND_API_KEY`. De lo contrario, la app genera el link y el usuario lo copia manualmente.

### ¬øNecesito el backend Express o solo Next.js?
**Solo Next.js es suficiente** para la mayor√≠a de casos. El backend Express es para:
- Procesos largos (>10s)
- WebSockets
- L√≥gica muy compleja

Next.js API Routes cubre el 95% de los casos.

### ¬øD√≥nde est√° el smart contract?
En `contracts/PeerProofRegistry.sol` (o similar). Ya est√° deployado en Base Sepolia. Puedes ver la address en `artifacts/`.

### ¬øC√≥mo actualizo el contrato?
```bash
# 1. Edita el contrato
vim contracts/HRKeyRegistry.sol

# 2. Compila
npm run compile

# 3. Deploy
npm run deploy:base-sepolia

# 4. Actualiza la address en .env
NEXT_PUBLIC_CONTRACT_ADDRESS=0xNuevaAddress
```

---

## üéì Para Aprender M√°s

### Tecnolog√≠as Clave
- **Next.js**: https://nextjs.org/docs
- **Supabase**: https://supabase.com/docs
- **ethers.js**: https://docs.ethers.org
- **Wagmi**: https://wagmi.sh/
- **Base**: https://docs.base.org/

### Tutoriales Recomendados
1. Next.js App Router (oficial)
2. Supabase + Next.js (oficial)
3. Building on Base (Coinbase)

---

## üõ†Ô∏è Debugging Com√∫n

### Error: "Supabase URL not defined"
**Causa**: Falta variable de entorno
**Fix**: Verifica que `NEXT_PUBLIC_SUPABASE_URL` est√© en Vercel

### Error: "Cannot find module '@/utils/appURL'"
**Causa**: Archivo faltante
**Fix**: Ya lo creamos en `/home/user/HRkey-App/HRkey/src/utils/appURL.ts`

### Error: "Build failed" en Vercel
**Causa**: Probablemente TypeScript errors
**Fix**: Corre `npm run build` localmente primero y corrige errores

### Emails no se env√≠an
**Causa**: Falta `RESEND_API_KEY` o est√° mal configurada
**Fix**:
1. Verifica key en Resend dashboard
2. Aseg√∫rate que est√© en variables de Vercel
3. Redeploy

### Transacci√≥n blockchain falla
**Causas comunes**:
1. No tienes ETH en tu wallet (Sepolia)
2. Red incorrecta (debe ser Base Sepolia)
3. Contrato no deployado

**Fixes**:
1. Consigue ETH Sepolia gratis: https://sepoliafaucet.com
2. En MetaMask, agrega Base Sepolia manualmente
3. Verifica que `NEXT_PUBLIC_CONTRACT_ADDRESS` sea correcta

---

## üìû Soporte

Si algo no funciona:

1. **Revisa logs** en Vercel Dashboard
2. **Lee** `DEPLOYMENT.md` secci√≥n Troubleshooting
3. **Verifica** todas las variables de entorno
4. **Prueba** localmente primero: `npm run dev`

---

## ‚úÖ Checklist: "¬øEntiendo el proyecto?"

- [ ] S√© qu√© hace HRKey (referencias profesionales)
- [ ] Entiendo los 4 componentes (Frontend, Supabase, Backend, Blockchain)
- [ ] S√© el flujo: solicitar ‚Üí enviar ‚Üí completar ‚Üí (blockchain)
- [ ] Entiendo los estados de referencia (draft, submitted, active, verified)
- [ ] S√© qu√© servicios externos se usan y para qu√©
- [ ] Entiendo la diferencia entre plan FREE y PRO
- [ ] S√© qu√© variables de entorno son necesarias m√≠nimo
- [ ] Puedo explicar por qu√© se usa blockchain (opcional)
- [ ] S√© d√≥nde est√° cada cosa en el c√≥digo

Si marcaste todos ‚úÖ, est√°s listo para deployar! üöÄ

---

**Pr√≥ximo paso**: Lee `DEPLOYMENT.md` para deployar paso a paso.
