<script>
  // Enviar KPIs al backend (no bloquea el flujo)
  async function sendKpisToBackend(kpis, context){
    try {
      await fetch('/api/kpi-suggestions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          kpis,
          position: context?.position || '',
          company: context?.company || '',
          userEmail: context?.userEmail || ''
        })
      });
    } catch(e){
      console.warn('KPI backend capture failed (non-blocking):', e);
    }
  }

  // ...dentro de submitReferenceRequest, justo despu√©s de armar `kpis`:
  // Buffer local eliminado. Llamamos al backend:
  sendKpisToBackend(kpis, {
    position: document.getElementById('position').value.trim(),
    company: document.getElementById('company').value.trim(),
    userEmail: user?.email || ''
  });
</script>
